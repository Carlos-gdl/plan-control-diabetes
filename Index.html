<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Plan Intensivo 10 d√≠as - Carlos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --bg1: #0f172a;
      --bg2: #1e293b;
      --card: rgba(15, 23, 42, 0.86);
      --primary: #38bdf8;
      --accent: #22c55e;
      --danger: #fb7185;
      --ok: #4ade80;
      --text-main: #f9fafb;
      --text-soft: #cbd5f5;
      --border-soft: rgba(148, 163, 184, 0.35);
      --radius-lg: 26px;
      --shadow-soft: 0 22px 55px rgba(15, 23, 42, 0.9);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      color: var(--text-main);
      transition: background 0.6s ease;
    }

    /* Tema d√≠a / noche */
    body.day {
      background: radial-gradient(circle at top, #1d4ed8 0, #020617 55%);
    }
    body.night {
      background: radial-gradient(circle at top, #020617 0, #020617 70%);
    }

    .app {
      width: 100%;
      max-width: 820px;
      padding: 28px 20px 40px;
    }

    header { margin-bottom: 18px; text-align: center; }

    .header-shell {
      position: relative;
      padding: 18px 24px;
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.88));
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: var(--shadow-soft);
      overflow: hidden;
    }
    .header-shell::before {
      content: "";
      position: absolute;
      inset: -40px;
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(34,197,94,0.16), transparent 60%);
      opacity: 0.9;
      pointer-events: none;
    }

    .header-content {
      position: relative;
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .avatar {
      width: 70px;
      height: 70px;
      border-radius: 24px;
      background: radial-gradient(circle at 30% 20%, #f97316, #db2777 55%, #1d4ed8 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      box-shadow: 0 12px 28px rgba(15,23,42,0.9);
      border: 2px solid rgba(15,23,42,0.6);
      flex-shrink: 0;
    }

    header h1 {
      font-size: 1.45rem;
      margin: 4px 0 6px;
      letter-spacing: 0.02em;
    }
    header p {
      margin: 0;
      font-size: 1rem;
      color: var(--text-soft);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15, 23, 42, 0.9);
      color: var(--primary);
      padding: 5px 14px;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 600;
      border: 1px solid rgba(56,189,248,0.55);
      margin-bottom: 10px;
    }
    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--primary);
      box-shadow: 0 0 10px rgba(56,189,248,0.8);
    }

    .tabs-shell {
      position: relative;
      margin-top: 14px;
      padding: 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.55);
      display: flex;
      gap: 8px;
      overflow-x: auto;
    }

    .tab-btn {
      flex: 1;
      border: none;
      background: transparent;
      padding: 10px 14px;
      border-radius: 999px;
      font-size: 1rem;
      color: var(--text-soft);
      cursor: grab;
      white-space: nowrap;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all 0.18s ease-out;
      user-select: none;
    }
    .tab-btn:active { cursor: grabbing; }
    .tab-btn span.emoji { font-size: 1.2rem; }

    .tab-btn.active {
      background: radial-gradient(circle at top, #38bdf8, #1d4ed8);
      color: #f9fafb;
      box-shadow: 0 10px 20px rgba(37, 99, 235, 0.8);
      font-weight: 600;
    }
    .tab-btn:not(.active):hover {
      background: rgba(15,23,42,0.9);
      color: #e5e7eb;
    }
    .tab-btn.dragging {
      opacity: 0.6;
      transform: scale(0.97);
    }

    .content-area { margin-top: 22px; }

    .card {
      background: var(--card);
      border-radius: 30px;
      padding: 24px 28px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-soft);
      backdrop-filter: blur(18px);
      margin-bottom: 20px;
    }

    .card h2 {
      font-size: 1.45rem;
      margin: 0 0 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .card h2 span.emoji { font-size: 1.8rem; }
    .card h3 {
      font-size: 1.2rem;
      margin: 12px 0 6px;
      color: #e5e7eb;
    }

    .time-pill {
      font-size: 0.9rem;
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      color: var(--primary);
      border: 1px solid rgba(56,189,248,0.6);
      font-weight: 600;
    }

    ul {
      margin: 8px 0;
      padding-left: 24px;
      font-size: 1.05rem;
      line-height: 1.6;
      color: var(--text-soft);
    }
    li { margin-bottom: 4px; }
    strong { color: #e5e7eb; }

    .sub-note {
      font-size: 0.95rem;
      color: var(--text-soft);
      margin-top: 10px;
    }

    .pill-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      font-size: 0.98rem;
    }
    .pill {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15,23,42,0.95);
    }
    .pill.bad {
      border-color: rgba(248, 113, 113, 0.9);
      background: rgba(127, 29, 29, 0.75);
      color: #fecaca;
    }
    .pill.good {
      border-color: rgba(74, 222, 128, 0.9);
      background: rgba(22, 101, 52, 0.78);
      color: #bbf7d0;
    }

    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-top: 14px;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    .glucose-row {
      display: flex;
      justify-content: space-between;
      font-size: 1.05rem;
      margin-top: 6px;
      color: var(--text-soft);
    }
    .glucose-value { font-weight: 600; }
    .glucose-value.ok { color: var(--ok); }
    .glucose-value.mid { color: #facc15; }
    .glucose-value.high { color: var(--danger); }

    .highlight {
      margin-top: 12px;
      border-radius: 20px;
      padding: 12px 14px;
      border: 1px dashed rgba(74, 222, 128, 0.7);
      background: rgba(6, 78, 59, 0.8);
      font-size: 0.98rem;
      color: #dcfce7;
    }

    .footer-note {
      font-size: 0.9rem;
      color: rgba(148, 163, 184, 0.9);
      text-align: center;
      margin-top: 18px;
    }

    .glucose-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 16px;
      margin-top: 10px;
    }
    .glucose-card {
      padding: 12px 14px;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.95);
      font-size: 0.95rem;
    }
    .glucose-card label {
      display: block;
      margin-bottom: 6px;
      color: var(--text-soft);
    }
    .glucose-card input[type="number"],
    .glucose-card input[type="time"] {
      width: 100%;
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
      font-size: 0.95rem;
    }
    .glucose-card small {
      display: block;
      margin-top: 6px;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 8px;
    }
    .btn-save {
      background: radial-gradient(circle at top, #22c55e, #16a34a);
      color: #f9fafb;
      box-shadow: 0 10px 20px rgba(22,163,74,0.7);
    }
    .btn-secondary {
      background: rgba(15,23,42,0.95);
      color: var(--text-soft);
      border: 1px solid rgba(148,163,184,0.7);
    }
    .btn-save:hover { filter: brightness(1.05); }

    .glucose-table-wrapper {
      margin-top: 14px;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.95);
      overflow: hidden;
    }
    table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
    th, td { padding: 8px 10px; text-align: center; }
    th {
      background: rgba(15,23,42,0.95);
      color: var(--text-soft);
      border-bottom: 1px solid rgba(148,163,184,0.6);
      font-weight: 600;
    }
    tr:nth-child(even) td { background: rgba(15,23,42,0.85); }
    tr:nth-child(odd) td { background: rgba(15,23,42,0.7); }

    .tag {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      display: inline-block;
    }
    .tag-ok {
      background: rgba(22,163,74,0.18);
      color: #4ade80;
      border: 1px solid rgba(74,222,128,0.7);
    }
    .tag-mid {
      background: rgba(234,179,8,0.18);
      color: #fde047;
      border: 1px solid rgba(250,204,21,0.7);
    }
    .tag-high {
      background: rgba(248,113,113,0.18);
      color: #fecaca;
      border: 1px solid rgba(248,113,113,0.7);
    }

    .reminder-banner {
      display: none;
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      background: radial-gradient(circle at top, #f97316, #ea580c);
      color: #fff7ed;
      padding: 10px 18px;
      border-radius: 999px;
      box-shadow: 0 16px 30px rgba(0,0,0,0.55);
      font-size: 0.95rem;
      z-index: 9999;
    }
    .reminder-banner span { margin-right: 8px; }
    .reminder-close {
      margin-left: 10px;
      cursor: pointer;
      font-weight: 700;
    }

    .chart-container {
      margin-top: 16px;
      padding: 12px 14px;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.95);
    }
    #glucose-trend-text {
      margin-top: 10px;
      font-size: 0.95rem;
      color: var(--text-soft);
    }
    #glucose-trend-text span { font-weight: 600; }

    .analysis-card {
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 18px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.7);
      font-size: 0.9rem;
      color: var(--text-soft);
    }

    .progress-shell {
      margin-top: 10px;
    }
    .progress-bar {
      width: 100%;
      height: 14px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.7);
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #16a34a, #84cc16);
      transition: width 0.5s ease;
    }
    .progress-text {
      margin-top: 6px;
      font-size: 0.9rem;
      color: var(--text-soft);
    }

    /* Chef mode */
    .chef-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 18px;
      margin-top: 10px;
    }
    .chef-card {
      border-radius: 22px;
      padding: 16px 16px 14px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(148,163,184,0.7);
      box-shadow: 0 14px 28px rgba(15,23,42,0.8);
    }
    .chef-card h3 {
      margin: 0 0 6px;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .chef-time {
      display: inline-block;
      margin-bottom: 6px;
      font-size: 0.85rem;
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.6);
      color: var(--text-soft);
    }
    .chef-list {
      margin: 0;
      padding-left: 18px;
      font-size: 0.95rem;
      color: var(--text-soft);
    }
    .chef-note {
      margin-top: 8px;
      font-size: 0.85rem;
      color: var(--text-soft);
    }

    @media (max-width: 480px) {
      .app {
        padding: 18px 12px 26px;
        max-width: 100%;
      }
      .header-shell { padding: 14px 12px; }
      .card {
        padding: 18px 16px 20px;
        border-radius: 22px;
      }
      header h1 { font-size: 1.15rem; }
      header p { font-size: 0.9rem; }
      .badge { font-size: 0.8rem; }
      .tab-btn { font-size: 0.85rem; padding: 8px 10px; }
      ul { font-size: 0.95rem; }
      .sub-note, .highlight, .footer-note { font-size: 0.85rem; }
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="app">
    <header>
      <div class="header-shell">
        <div class="badge">
          <span class="badge-dot"></span>
          Plan intensivo 10 d√≠as
        </div>
        <div class="header-content">
          <div class="avatar">‚ù§Ô∏è</div>
          <div>
            <h1>Plan de comida y Glucosa de Carlos</h1>
            <p>Control diario para control de glucosa r√°pida d√≠a.</p>
          </div>
        </div>

        <!-- TABS -->
        <div class="tabs-shell">
          <button class="tab-btn active" data-tab="desayuno">
            <span class="emoji">üåÖ</span><span>Desayuno</span>
          </button>
          <button class="tab-btn" data-tab="comida">
            <span class="emoji">üçΩÔ∏è</span><span>Comida</span>
          </button>
          <button class="tab-btn" data-tab="cena">
            <span class="emoji">üåô</span><span>Noche</span>
          </button>
          <button class="tab-btn" data-tab="hidratacion">
            <span class="emoji">üíß</span><span>Hidrataci√≥n</span>
          </button>
          <button class="tab-btn" data-tab="glucosa">
            <span class="emoji">üìâ</span><span>Glucosa</span>
          </button>
          <button class="tab-btn" data-tab="prohibido">
            <span class="emoji">üö´</span><span>Prohibidos</span>
          </button>
          <button class="tab-btn" data-tab="chef">
            <span class="emoji">üë©‚Äçüç≥</span><span>Chef</span>
          </button>
        </div>
      </div>
    </header>

    <div class="content-area">
      <!-- DESAYUNO -->
      <section class="card tab-content" id="tab-desayuno">
        <h2><span class="emoji">üåÖ</span>Desayuno <span class="time-pill">10:00 AM</span></h2>
        <h3>Qu√© debe darte de comer</h3>
        <ul>
          <li><strong>4 huevos hervidos</strong> (seg√∫n el hambre, 4 est√° bien).</li>
          <li><strong>¬Ω aguacate</strong> (puede ser 1 entero si hay mucha hambre).</li>
          <li><strong>Verduras libres:</strong> pepino, espinaca, calabacita, jitomate, etc.</li>
          <li><strong>Caf√© o t√© sin az√∫car</strong> (se puede endulzar con Stevia).</li>
          <li><strong>1 taza del brebaje:</strong> 250 ml de agua + canela + Jengibre + hojas de laurel +  2 clavos de olor.</li>
          <li><strong>+ 1 vaso de agua extra</strong> junto con el desayuno.</li>
        </ul>
        <p class="sub-note">
          Este desayuno <strong>NO</strong> sube la glucosa y ayuda a proteger ri√±ones y p√°ncreas.
        </p>

        <h3>Despu√©s del desayuno</h3>
        <ul>
          <li><strong>10 minutos de caminata</strong> (de 10:20 a 10:30). Puede ser dentro de casa.</li>
        </ul>
        <p class="sub-note">
          Esta caminata es una de las herramientas m√°s fuertes para bajar la glucosa despu√©s de desayunar.
        </p>
      </section>

      <!-- COMIDA -->
      <section class="card tab-content" id="tab-comida" style="display:none;">
        <h2><span class="emoji">üçΩÔ∏è</span>Comida <span class="time-pill">3:00 PM</span></h2>
        <h3>Prote√≠na (elegir solo una opci√≥n)</h3>
        <ul>
          <li>200‚Äì300 g de <strong>pollo</strong></li>
          <li>200‚Äì300 g de <strong>carne de res</strong></li>
          <li>200‚Äì300 g de <strong>carne de cerdo magro</strong></li>
          <li>250‚Äì300 g de <strong>pescado</strong></li>
        </ul>
        <p class="sub-note">
          Puedes comer esas cantidades sin problema y sin subir la glucosa.
        </p>

        <h3>Grasa para cocinar</h3>
        <ul>
          <li><strong>1 cucharadita de manteca de cerdo natural</strong> para guisar.</li>
        </ul>

        <h3>Verduras</h3>
        <ul>
          <li>Verduras <strong>ilimitadas</strong>: br√≥coli, calabacitas, espinaca, acelga, pepino, ensalada verde.</li>
        </ul>

        <h3>Agua</h3>
        <ul>
          <li>1 vaso grande de agua simple <strong>antes de comer</strong>.</li>
        </ul>

        <h3>Despu√©s de comer</h3>
        <ul>
          <li><strong>10 minutos de caminata</strong> (de 3:30 a 3:40 PM).</li>
        </ul>
        <p class="sub-note">
          Sin esta caminata, la glucosa de la tarde no bajar√° como se necesita.
        </p>
      </section>

      <!-- NOCHE -->
      <section class="card tab-content" id="tab-cena" style="display:none;">
        <h2><span class="emoji">üåô</span>Noche <span class="time-pill">9:40‚Äì10:00 PM</span></h2>
        <h3>En lugar de cena s√≥lida</h3>
        <ul>
          <li><strong>Infusi√≥n de or√©gano + jengibre + clavo</strong>:</li>
          <ul>
            <li>250 ml de agua</li>
            <li>1 cucharadita de or√©gano seco</li>
            <li>1 rodaja de jengibre</li>
            <li>1‚Äì2 clavos de olor</li>
          </ul>
          <li>Hervir 3‚Äì5 minutos, reposar 10 minutos, colar y tomar tibio.</li>
        </ul>
        <p class="sub-note">
          Esta infusi√≥n ayuda a desinflamar intestino, reducir gases, combatir c√°ndida y mejorar la glucosa nocturna.
        </p>
      </section>

      <!-- HIDRATACI√ìN -->
      <section class="card tab-content" id="tab-hidratacion" style="display:none;">
        <h2><span class="emoji">üíß</span>Hidrataci√≥n diaria</h2>
        <ul>
          <li><strong>2‚Äì2.5 litros de agua</strong> al d√≠a (hasta 3 L si hace calor).</li>
          <li><strong>El brebaje</strong> (canela + laurel + clavo) solo 1 taza al d√≠a.</li>
          <li>Evitar refrescos, jugos y aguas con az√∫car.</li>
          <li>Jardiance hace que elimines glucosa por la orina, por eso es importante estar bien hidratado.</li>
        </ul>
        <div class="highlight">
          Mientras tomes Jardiance, la buena hidrataci√≥n es clave para cuidar tus ri√±ones y evitar deshidrataci√≥n.
        </div>
      </section>

      <!-- GLUCOSA -->
      <section class="card tab-content" id="tab-glucosa" style="display:none;">
        <h2><span class="emoji">üìâ</span>Glucosa</h2>
        <p class="sub-note">
          Aqu√≠ registras tus mediciones diarias y la app te ayuda a ver tu avance.
        </p>

        <div class="section-title">Metas en estos 10 d√≠as</div>
        <div class="glucose-row">
          <span>D√≠as 1‚Äì3 (ayunas):</span>
          <span class="glucose-value mid">150‚Äì180 mg/dL</span>
        </div>
        <div class="glucose-row">
          <span>D√≠as 4‚Äì6 (ayunas):</span>
          <span class="glucose-value mid">135‚Äì160 mg/dL</span>
        </div>
        <div class="glucose-row">
          <span>D√≠as 7‚Äì10 (ayunas):</span>
          <span class="glucose-value ok">120‚Äì150 mg/dL</span>
        </div>

        <div class="highlight">
          Cuando tu glucosa en ayunas se mantenga entre 120‚Äì150 mg/dL varios d√≠as seguidos, se podr√° empezar a ajustar el medicamento de forma segura.
        </div>

        <div class="section-title" style="margin-top:16px;">Registro diario de glucosa</div>

        <div class="glucose-grid">
          <div class="glucose-card">
            <label for="glucose-am"><strong>Glucosa al despertar (ayunas)</strong></label>
            <input id="glucose-am" type="number" min="40" max="600" placeholder="Ej. 160" />
            <small>Medir apenas despiertes, antes de comer o tomar tu brebaje.</small>
            <button class="btn btn-save" id="save-am">üíæ Guardar ayunas</button>
          </div>

          <div class="glucose-card">
            <label for="glucose-pm"><strong>Glucosa 2 h despu√©s de la comida</strong></label>
            <input id="glucose-pm" type="number" min="40" max="600" placeholder="Ej. 180" />
            <small>Medir a las 5:00 PM aprox., 2 horas despu√©s de la comida.</small>
            <button class="btn btn-save" id="save-pm">üíæ Guardar 5 PM</button>
          </div>

          <div class="glucose-card">
            <label for="time-am">Hora para medir en ayunas</label>
            <input id="time-am" type="time" />
            <small>La app te avisar√° 5 minutos antes de esta hora.</small>
            <label for="time-pm" style="margin-top:10px; display:block;">Hora para medir despu√©s de la comida</label>
            <input id="time-pm" type="time" />
            <small>Por defecto 17:00 (5 PM). La app recordar√° 5 min antes.</small>
          </div>
        </div>

        <div class="section-title" style="margin-top:18px;">Progreso hacia la meta</div>
        <div class="progress-shell">
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <div class="progress-text" id="progress-text">Sin datos suficientes.</div>
        </div>

        <div class="section-title" style="margin-top:18px;">Evoluci√≥n de la glucosa</div>
        <div class="chart-container">
          <canvas id="glucose-chart" height="220"></canvas>
          <div id="glucose-trend-text">Tendencia: <span>‚Äî</span></div>
        </div>

        <div class="analysis-card" id="glucose-analysis">
          A√∫n no hay datos suficientes para an√°lisis.
        </div>

        <div class="glucose-table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Ayunas</th>
                <th>Post comida (5 PM)</th>
              </tr>
            </thead>
            <tbody id="glucose-table-body"></tbody>
          </table>
        </div>

        <button class="btn btn-secondary" id="export-pdf" style="margin-top:12px;">
          üìÑ Exportar reporte en PDF
        </button>
      </section>

      <!-- PROHIBIDOS -->
      <section class="card tab-content" id="tab-prohibido" style="display:none;">
        <h2><span class="emoji">üö´</span>Alimentos prohibidos estos 10 d√≠as</h2>
        <p class="sub-note">
          Estos alimentos suben mucho la glucosa (pueden llevarte a 230‚Äì260 mg/dL).
        </p>

        <div class="section-title">NO comer en ning√∫n momento</div>
        <div class="pill-list">
          <span class="pill bad">Tortillas</span>
          <span class="pill bad">Arroz</span>
          <span class="pill bad">Pan</span>
          <span class="pill bad">Pasta</span>
          <span class="pill bad">Frijoles</span>
          <span class="pill bad">Frutas</span>
          <span class="pill bad">Jugos</span>
          <span class="pill bad">Refrescos</span>
          <span class="pill bad">Aguas azucaradas</span>
        </div>

        <div class="section-title">Verduras siempre permitidas</div>
        <div class="pill-list">
          <span class="pill good">Pepino</span>
          <span class="pill good">Espinaca</span>
          <span class="pill good">Calabacita</span>
          <span class="pill good">Br√≥coli</span>
          <span class="pill good">Acelga</span>
          <span class="pill good">Lechuga</span>
          <span class="pill good">Ensalada verde</span>
          <span class="pill good">Jitomate</span>
        </div>

        <p class="sub-note">
          Si respetas esta lista, la glucosa bajar√° mucho m√°s r√°pido y de forma segura.
        </p>
      </section>

      <!-- CHEF MODE -->
      <section class="card tab-content" id="tab-chef" style="display:none;">
        <h2><span class="emoji">üë©‚Äçüç≥</span>Modo Chef</h2>
        <p class="sub-note">
          Vista r√°pida para la cocina. Solo muestra qu√© preparar en cada momento del d√≠a.
        </p>

        <div class="chef-grid">
          <div class="chef-card">
            <h3>üåÖ Desayuno</h3>
            <span class="chef-time">10:00 AM</span>
            <ul class="chef-list">
              <li>4 huevos hervidos (seg√∫n hambre).</li>
              <li>¬Ω‚Äì1 aguacate.</li>
              <li>Verduras: pepino, espinaca, calabacita, jitomate.</li>
              <li>Caf√© o t√© sin az√∫car (Stevia opcional).</li>
              <li>1 taza de brebaje: 250 ml agua + canela + jengibre + laurel + 2 clavos de olor.</li>
              <li>+ 1 vaso de agua.</li>
            </ul>
            <p class="chef-note">Despu√©s: 10 min de caminata.</p>
          </div>

          <div class="chef-card">
            <h3>üçΩÔ∏è Comida</h3>
            <span class="chef-time">3:00 PM</span>
            <ul class="chef-list">
              <li>Elegir solo 1 prote√≠na:</li>
              <li>‚Ä¢ 200‚Äì300 g pollo, res o cerdo magro.</li>
              <li>‚Ä¢ 250‚Äì300 g pescado.</li>
              <li>1 cdita de manteca de cerdo natural para guisar.</li>
              <li>Verduras ilimitadas (br√≥coli, calabaza, ensalada verde, etc.).</li>
            </ul>
            <p class="chef-note">Dar 1 vaso de agua antes de comer.</p>
          </div>

          <div class="chef-card">
            <h3>üåô Noche</h3>
            <span class="chef-time">9:40‚Äì10:00 PM</span>
            <ul class="chef-list">
              <li>Infusi√≥n en lugar de cena s√≥lida:</li>
              <li>‚Ä¢ 250 ml de agua</li>
              <li>‚Ä¢ 1 cdita de or√©gano seco</li>
              <li>‚Ä¢ 1 rodaja de jengibre</li>
              <li>‚Ä¢ 2 clavos de olor</li>              
            </ul>
            <p class="chef-note">Hervir 3‚Äì5 min, reposar 10 min, colar y servir tibio.</p>
          </div>
        </div>
      </section>

      <p class="footer-note">
        Esta gu√≠a es solo para uso diario en casa. Si hay s√≠ntomas raros o glucosa muy baja (&lt;80), consulta a tu m√©dico.
      </p>
    </div>
  </div>

  <div class="reminder-banner" id="reminder-banner">
    <span id="reminder-text">‚è∞ Toca medir glucosa</span>
    <span class="reminder-close" id="reminder-close">X</span>
  </div>

  <script>
    // --------- Tema d√≠a / noche ---------
    function applyThemeByHour() {
      const hour = new Date().getHours();
      if (hour >= 19 || hour < 7) {
        document.body.classList.add("night");
        document.body.classList.remove("day");
      } else {
        document.body.classList.add("day");
        document.body.classList.remove("night");
      }
    }

    // ---------- TABS + DRAG & DROP ----------
    const tabsShell = document.querySelector(".tabs-shell");
    const contents = document.querySelectorAll(".tab-content");
    const TAB_ORDER_KEY = "tabOrderV1";

    function activateTab(btn) {
      const allTabs = tabsShell.querySelectorAll(".tab-btn");
      const target = btn.getAttribute("data-tab");
      allTabs.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      contents.forEach(c => {
        c.style.display = c.id === "tab-" + target ? "block" : "none";
      });
    }

    // Restaurar orden de tabs
    (function restoreTabOrder() {
      const saved = localStorage.getItem(TAB_ORDER_KEY);
      if (!saved) return;
      try {
        const order = JSON.parse(saved);
        order.forEach(tabName => {
          const btn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
          if (btn) tabsShell.appendChild(btn);
        });
      } catch (e) {}
    })();

    // Click en tabs
    tabsShell.addEventListener("click", (e) => {
      const btn = e.target.closest(".tab-btn");
      if (!btn) return;
      activateTab(btn);
    });

    // Drag & drop tabs
    let draggedTab = null;
    function saveTabOrder() {
      const order = [...tabsShell.querySelectorAll(".tab-btn")].map(b => b.dataset.tab);
      localStorage.setItem(TAB_ORDER_KEY, JSON.stringify(order));
    }

    function attachDragEvents() {
      tabsShell.querySelectorAll(".tab-btn").forEach(btn => {
        btn.setAttribute("draggable", "true");
        btn.addEventListener("dragstart", () => {
          draggedTab = btn;
          btn.classList.add("dragging");
        });
        btn.addEventListener("dragend", () => {
          draggedTab = null;
          btn.classList.remove("dragging");
          saveTabOrder();
        });
      });
    }
    attachDragEvents();

    tabsShell.addEventListener("dragover", (e) => {
      e.preventDefault();
      if (!draggedTab) return;
      const afterElement = getDragAfterElement(tabsShell, e.clientX);
      if (!afterElement) {
        tabsShell.appendChild(draggedTab);
      } else {
        tabsShell.insertBefore(draggedTab, afterElement);
      }
    });

    function getDragAfterElement(container, x) {
      const draggableElements = [...container.querySelectorAll(".tab-btn:not(.dragging)")];
      let closest = { offset: Number.NEGATIVE_INFINITY, element: null };
      draggableElements.forEach(child => {
        const box = child.getBoundingClientRect();
        const offset = x - box.left - box.width / 2;
        if (offset < 0 && offset > closest.offset) {
          closest = { offset, element: child };
        }
      });
      return closest.element;
    }

    // Mostrar inicialmente Desayuno
    activateTab(document.querySelector('.tab-btn[data-tab="desayuno"]'));

    // ---------- GLUCOSA / RECORDATORIOS / GR√ÅFICA ----------
    const STORAGE_KEY = "glucoseLogV1";
    const SETTINGS_KEY = "glucoseSettingsV1";
    const REMINDER_KEY = "glucoseRemindersV1";

    const amInput = document.getElementById("glucose-am");
    const pmInput = document.getElementById("glucose-pm");
    const saveAmBtn = document.getElementById("save-am");
    const savePmBtn = document.getElementById("save-pm");
    const tableBody = document.getElementById("glucose-table-body");
    const timeAmInput = document.getElementById("time-am");
    const timePmInput = document.getElementById("time-pm");
    const banner = document.getElementById("reminder-banner");
    const bannerText = document.getElementById("reminder-text");
    const bannerClose = document.getElementById("reminder-close");
    const trendTextEl = document.getElementById("glucose-trend-text").querySelector("span");
    const progressFill = document.getElementById("progress-fill");
    const progressText = document.getElementById("progress-text");
    const analysisBox = document.getElementById("glucose-analysis");
    let glucoseChart = null;

    function getTodayKey() {
      const d = new Date();
      return d.toISOString().slice(0, 10);
    }
    function loadLog() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; }
      catch (e) { return {}; }
    }
    function saveLog(log) { localStorage.setItem(STORAGE_KEY, JSON.stringify(log)); }
    function loadSettings() {
      try { return JSON.parse(localStorage.getItem(SETTINGS_KEY)) || {}; }
      catch (e) { return {}; }
    }
    function saveSettings(settings) { localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings)); }
    function loadReminders() {
      try { return JSON.parse(localStorage.getItem(REMINDER_KEY)) || {}; }
      catch (e) { return {}; }
    }
    function saveReminders(data) { localStorage.setItem(REMINDER_KEY, JSON.stringify(data)); }

    function classifyValue(val, fasting = true) {
      if (!val && val !== 0) return "";
      if (fasting) {
        if (val <= 150) return "ok";
        if (val <= 180) return "mid";
        return "high";
      } else {
        if (val <= 160) return "ok";
        if (val <= 200) return "mid";
        return "high";
      }
    }
    function tagLabel(cls) {
      if (cls === "ok") return "Objetivo";
      if (cls === "mid") return "Aceptable";
      if (cls === "high") return "Alta";
      return "";
    }

    function renderTable() {
      const log = loadLog();
      const keys = Object.keys(log).sort().reverse();
      tableBody.innerHTML = "";
      keys.slice(0, 14).forEach(date => {
        const row = document.createElement("tr");
        const day = log[date] || {};
        const amVal = day.am;
        const pmVal = day.pm;
        const amCls = classifyValue(amVal, true);
        const pmCls = classifyValue(pmVal, false);

        row.innerHTML = `
          <td>${date}</td>
          <td>
            ${amVal ? amVal + ' mg/dL' : '-'}
            ${amCls ? `<div class="tag tag-${amCls}">${tagLabel(amCls)}</div>` : ""}
          </td>
          <td>
            ${pmVal ? pmVal + ' mg/dL' : '-'}
            ${pmCls ? `<div class="tag tag-${pmCls}">${tagLabel(pmCls)}</div>` : ""}
          </td>
        `;
        tableBody.appendChild(row);
      });

      renderChart();
      updateTrendSummary();
      updateProgress();
      updateAnalysis();
    }

    function saveGlucose(type) {
      const log = loadLog();
      const today = getTodayKey();
      const day = log[today] || {};
      if (type === "am") {
        const val = Number(amInput.value);
        if (!val) return;
        day.am = val;
      } else {
        const val = Number(pmInput.value);
        if (!val) return;
        day.pm = val;
      }
      log[today] = day;
      saveLog(log);
      renderTable();
    }

    saveAmBtn.addEventListener("click", () => {
      saveGlucose("am");
      saveReminders({ ...loadReminders(), lastAmMeasureDate: getTodayKey() });
    });
    savePmBtn.addEventListener("click", () => {
      saveGlucose("pm");
      saveReminders({ ...loadReminders(), lastPmMeasureDate: getTodayKey() });
    });
    bannerClose.addEventListener("click", () => { banner.style.display = "none"; });

    function initSettings() {
      const settings = loadSettings();
      if (!settings.amTime) settings.amTime = "09:45";
      if (!settings.pmTime) settings.pmTime = "17:00";
      timeAmInput.value = settings.amTime;
      timePmInput.value = settings.pmTime;
      saveSettings(settings);

      timeAmInput.addEventListener("change", () => {
        const s = loadSettings();
        s.amTime = timeAmInput.value || "09:45";
        saveSettings(s);
      });
      timePmInput.addEventListener("change", () => {
        const s = loadSettings();
        s.pmTime = timePmInput.value || "17:00";
        saveSettings(s);
      });
    }

    function parseTimeToDate(timeStr) {
      if (!timeStr) return null;
      const [h, m] = timeStr.split(":").map(Number);
      const d = new Date();
      d.setHours(h, m, 0, 0);
      return d;
    }

    function checkReminders() {
      const settings = loadSettings();
      const reminders = loadReminders();
      const now = new Date();
      const today = getTodayKey();

      function shouldRemind(keyTime, type, label) {
        const target = parseTimeToDate(keyTime);
        if (!target) return;
        const reminderTime = new Date(target.getTime() - 5 * 60000);
        const windowEnd = new Date(reminderTime.getTime() + 4 * 60000);
        if (now >= reminderTime && now <= windowEnd) {
          const lastKey = type === "am" ? "lastAmReminderDate" : "lastPmReminderDate";
          if (reminders[lastKey] !== today) {
            bannerText.textContent = `‚è∞ En 5 min toca medir tu glucosa ${label}`;
            banner.style.display = "flex";
            reminders[lastKey] = today;
            saveReminders(reminders);
          }
        }
      }

      shouldRemind(settings.amTime, "am", "en ayunas");
      shouldRemind(settings.pmTime, "pm", "2 h despu√©s de la comida");
    }

    function renderChart() {
      const log = loadLog();
      const dates = Object.keys(log).sort();
      const labels = [];
      const dataAm = [];
      const dataPm = [];

      dates.forEach(date => {
        const day = log[date] || {};
        labels.push(date.slice(5));
        dataAm.push(day.am !== undefined ? day.am : null);
        dataPm.push(day.pm !== undefined ? day.pm : null);
      });

      const ctx = document.getElementById("glucose-chart");
      if (!ctx || labels.length === 0) return;
      if (glucoseChart) glucoseChart.destroy();

      glucoseChart = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [
            { label: "Ayunas", data: dataAm, borderWidth: 2, tension: 0.3, pointRadius: 3 },
            { label: "Post comida (5 PM)", data: dataPm, borderWidth: 2, tension: 0.3, pointRadius: 3 }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { labels: { color: "#e5e7eb", font: { size: 11 } } }
          },
          scales: {
            x: {
              ticks: { color: "#9ca3af" },
              grid: { color: "rgba(55,65,81,0.4)" }
            },
            y: {
              ticks: { color: "#9ca3af" },
              grid: { color: "rgba(55,65,81,0.4)" }
            }
          }
        }
      });
    }

    function updateTrendSummary() {
      const log = loadLog();
      const dates = Object.keys(log).sort();
      if (dates.length < 2) {
        trendTextEl.textContent = "A√∫n no hay suficientes datos para calcular la tendencia.";
        trendTextEl.style.color = "#e5e7eb";
        return;
      }

      const fastingValues = [];
      for (let i = dates.length - 1; i >= 0 && fastingValues.length < 3; i--) {
        const day = log[dates[i]];
        if (day && typeof day.am === "number") fastingValues.push(day.am);
      }

      if (fastingValues.length < 2) {
        trendTextEl.textContent = "Faltan mediciones en ayunas para ver la tendencia.";
        trendTextEl.style.color = "#e5e7eb";
        return;
      }

      const latest = fastingValues[0];
      const prev = fastingValues[1];
      const diff = latest - prev;

      if (diff <= -5) {
        trendTextEl.textContent = `A la baja (mejorando). √öltima ayunas: ${latest} mg/dL`;
        trendTextEl.style.color = "#4ade80";
      } else if (diff >= 5) {
        trendTextEl.textContent = `Al alza (revisar plan). √öltima ayunas: ${latest} mg/dL`;
        trendTextEl.style.color = "#fb7185";
      } else {
        trendTextEl.textContent = `Estable. √öltima ayunas: ${latest} mg/dL`;
        trendTextEl.style.color = "#e5e7eb";
      }
    }

    function updateProgress() {
      const log = loadLog();
      const dates = Object.keys(log).sort();
      const fasting = dates
        .map(d => ({ date: d, val: log[d].am }))
        .filter(x => typeof x.val === "number");

      if ( fasting.length < 2 ) {
        progressFill.style.width = "0%";
        progressText.textContent = "Sin suficientes mediciones en ayunas para calcular progreso.";
        return;
      }

      const first = fasting[0].val;
      const latest = fasting[fasting.length - 1].val;
      const goal = 140;

      if (first <= goal) {
        progressFill.style.width = "100%";
        progressText.textContent = `Ya est√°s en meta (‚â§ ${goal} mg/dL). √öltima ayunas: ${latest} mg/dL.`;
        return;
      }

      const totalDropNeeded = first - goal;
      const dropSoFar = Math.max(0, first - latest);
      let pct = Math.min(100, Math.max(0, (dropSoFar / totalDropNeeded) * 100));

      progressFill.style.width = pct.toFixed(0) + "%";
      progressText.textContent = `Progreso: ${pct.toFixed(0)}% hacia la meta (de ${first} ‚Üí ${goal} mg/dL). √öltima ayunas: ${latest} mg/dL.`;
    }

    function updateAnalysis() {
      const log = loadLog();
      const dates = Object.keys(log).sort();
      if (dates.length === 0) {
        analysisBox.textContent = "A√∫n no hay datos de glucosa registrados.";
        return;
      }

      const records = dates.map(d => ({ date: d, am: log[d].am, pm: log[d].pm }))
                           .filter(r => typeof r.am === "number" || typeof r.pm === "number");

      const fastingVals = records.filter(r => typeof r.am === "number").map(r => r.am);
      const postVals = records.filter(r => typeof r.pm === "number").map(r => r.pm);

      let html = "";

      if (fastingVals.length) {
        const avgLast3 = fastingVals.slice(-3).reduce((a,b)=>a+b,0) / Math.min(3, fastingVals.length);
        const last = fastingVals[fastingVals.length-1];
        const first = fastingVals[0];
        const diff = last - first;
        const inTarget = fastingVals.filter(v => v >=120 && v<=150).length;

        html += `<p><strong>Ayunas:</strong></p>`;
        html += `<ul>
          <li>Promedio √∫ltimas mediciones: <strong>${avgLast3.toFixed(1)} mg/dL</strong>.</li>
          <li>Cambio desde el inicio: <strong>${diff >= 0 ? "+"+diff.toFixed(0) : diff.toFixed(0)} mg/dL</strong>.</li>
          <li>D√≠as dentro del rango objetivo (120‚Äì150): <strong>${inTarget}</strong>.</li>
        </ul>`;
      }

      if (postVals.length) {
        const avgPost = postVals.slice(-3).reduce((a,b)=>a+b,0) / Math.min(3, postVals.length);
        const inTargetPost = postVals.filter(v => v <= 160).length;
        html += `<p><strong>Post comida (5 PM):</strong></p>`;
        html += `<ul>
          <li>Promedio √∫ltimas mediciones: <strong>${avgPost.toFixed(1)} mg/dL</strong>.</li>
          <li>Lecturas en objetivo (&le;160 mg/dL): <strong>${inTargetPost}</strong>.</li>
        </ul>`;
      }

      if (!html) {
        analysisBox.textContent = "A√∫n no hay suficientes mediciones para un an√°lisis detallado.";
      } else {
        analysisBox.innerHTML = html;
      }
    }

    // Exportar a PDF
    document.getElementById("export-pdf").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const log = loadLog();
      const dates = Object.keys(log).sort();
      const fasting = dates
        .map(d => ({ date: d, val: log[d].am }))
        .filter(x => typeof x.val === "number");

      doc.setFontSize(14);
      doc.text("Reporte de glucosa - Carlos", 10, 15);
      doc.setFontSize(10);
      doc.text("Generado autom√°ticamente por la app de control.", 10, 21);

      const canvas = document.getElementById("glucose-chart");
      if (canvas) {
        const imgData = canvas.toDataURL("image/png");
        doc.addImage(imgData, "PNG", 10, 25, 180, 70);
      }

      let y = 100;
      if (fasting.length) {
        const first = fasting[0].val;
        const last = fasting[fasting.length-1].val;
        doc.setFontSize(12);
        doc.text("Resumen de ayunas:", 10, y);
        y += 6;
        doc.setFontSize(10);
        doc.text(`Inicio: ${first} mg/dL`, 10, y); y += 5;
        doc.text(`√öltima: ${last} mg/dL`, 10, y); y += 5;
      }

      y += 4;
      doc.setFontSize(11);
      doc.text("√öltimos registros:", 10, y); y += 6;
      doc.setFontSize(9);
      dates.slice(-10).forEach(d => {
        const day = log[d];
        const line = `${d}  |  Ayunas: ${day.am ?? "-"}  |  5 PM: ${day.pm ?? "-"}`;
        doc.text(line, 10, y);
        y += 5;
        if (y > 280) { doc.addPage(); y = 15; }
      });

      doc.save("reporte_glucosa_carlos.pdf");
    });

    // INIT
    document.addEventListener("DOMContentLoaded", () => {
      applyThemeByHour();
      renderTable();
      initSettings();
      setInterval(checkReminders, 30000);
    });
  </script>
</body>
</html>

